<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小说风向标</title>
    <meta name="description" content="小说风向标 - 多平台排行榜数据聚合、市场分析、热度追踪">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- 动态背景 -->
    <div class="bg-gradient"></div>
    <div class="bg-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
    </div>

    <!-- 主容器 -->
    <div class="app-container">
        <!-- 顶部导航 -->
        <header class="app-header glass-surface">
            <div class="header-left">
                <svg class="logo-icon" width="32" height="32" viewBox="0 0 24 24" fill="none">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M8 7h8M8 11h5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
                <h1 class="app-title">小说风向标</h1>
            </div>
            <div class="header-right">
                <button class="icon-btn" id="btnDownloadMgr" title="下载管理" onclick="toggleDownloadPage()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <polyline points="7 10 12 15 17 10" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" />
                    </svg>
                </button>
                <button class="icon-btn" id="btnSettings" title="设置" onclick="openSettingsModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
                <button class="icon-btn" id="btnTheme" title="切换主题" onclick="toggleTheme()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
        </header>

        <nav class="tab-nav glass-card" id="tabNav">
            <button class="tab-btn active" data-tab="dashboard" onclick="switchTab('dashboard')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M3 3h7v9H3V3zM14 3h7v5h-7V3zM14 12h7v9h-7v-9zM3 16h7v5H3v-5z" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                市场看板
            </button>
            <button class="tab-btn" data-tab="rank" onclick="switchTab('rank')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M12 20V10M6 20V4M18 20v-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                排行榜
            </button>
        </nav>

        <!-- ==================== 市场看板 Tab ==================== -->
        <div class="tab-content" id="tabDashboard">
            <!-- 数据获取状态 -->
            <section class="fetch-status glass-card" id="fetchStatus">
                <div class="fetch-info">
                    <div class="fetch-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                            <path
                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                                stroke="currentColor" stroke-width="2" />
                        </svg>
                    </div>
                    <div>
                        <h3 id="fetchTitle">数据状态</h3>
                        <p id="fetchDesc" class="fetch-desc">检查中...</p>
                    </div>
                </div>
                <div class="fetch-actions">
                    <button class="btn btn-primary" id="btnFetchAll" onclick="fetchAllData()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M21 12a9 9 0 1 1-6.22-8.56" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M21 3v6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        全量获取数据
                    </button>
                    <button class="btn btn-outline" onclick="fetchAllData(true)">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M23 4v6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M1 20v-6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        强制刷新
                    </button>
                    <button class="btn btn-secondary" id="btnNotifyFeishu" onclick="notifyFeishuGroup()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        通知飞书群
                    </button>
                </div>
            </section>

            <!-- 加载动画 -->
            <section class="loading-section glass-card" id="dashLoadingSection" style="display:none">
                <div class="loading-spinner">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" class="spin">
                        <path d="M21 12a9 9 0 1 1-6.22-8.56" stroke="currentColor" stroke-width="2.5"
                            stroke-linecap="round" />
                    </svg>
                </div>
                <p class="loading-message" id="dashLoadingMsg">正在全量抓取数据...</p>
            </section>

            <!-- 看板内容 -->
            <div id="dashboardContent" style="display:none">
                <!-- 平台统计卡片 -->
                <section class="dashboard-stats" id="sourceStatsGrid"></section>

                <!-- 图表区域 -->
                <div class="chart-grid">
                    <!-- 男女频占比 -->
                    <section class="glass-card chart-card">
                        <div class="chart-card-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" />
                            </svg>
                            <h3>频道分布</h3>
                        </div>
                        <div class="chart-body" id="genderChart"></div>
                    </section>

                    <!-- 分类热度 -->
                    <section class="glass-card chart-card">
                        <div class="chart-card-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                                <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                                <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                                <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor"
                                    stroke-width="2" />
                            </svg>
                            <h3>题材热度 Top 15</h3>
                        </div>
                        <div class="chart-body chart-body-tall" id="categoryChart"></div>
                    </section>
                </div>

                <!-- 在读排行 男频/女频 -->
                <div class="heat-rank-section">
                    <div class="heat-rank-col glass-card">
                        <div class="chart-card-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2c.5 4-3 6-3 10a5 5 0 0 0 10 0c0-4-3-6-3-10" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" />
                            </svg>
                            <h3>🔥 男频在读排行</h3>
                        </div>
                        <div class="heat-rank-list" id="heatRankMale"></div>
                    </div>
                    <div class="heat-rank-col glass-card">
                        <div class="chart-card-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2c.5 4-3 6-3 10a5 5 0 0 0 10 0c0-4-3-6-3-10" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" />
                            </svg>
                            <h3>🔥 女频在读排行</h3>
                        </div>
                        <div class="heat-rank-list" id="heatRankFemale"></div>
                    </div>
                </div>

                <!-- 跨平台热门书籍 -->
                <section class="glass-card cross-platform-section">
                    <div class="chart-card-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path
                                d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <h3>🔥 跨平台热门作品</h3>
                        <span class="chart-badge" id="crossCount">0</span>
                    </div>
                    <p class="cross-desc">以下书籍同时出现在多个平台排行榜，市场热度较高</p>
                    <div id="crossPlatformTable"></div>
                </section>
            </div>

            <!-- 无数据状态 -->
            <section class="empty-state glass-card" id="dashEmpty" style="display:none">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" class="empty-icon">
                    <path d="M3 3h7v9H3V3zM14 3h7v5h-7V3zM14 12h7v9h-7v-9zM3 16h7v5H3v-5z" stroke="currentColor"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <h3>暂无数据</h3>
                <p>点击「全量获取数据」抓取所有平台排行榜</p>
            </section>
        </div>

        <!-- ==================== 排行榜 Tab ==================== -->
        <div class="tab-content" id="tabRank" style="display:none">
            <!-- 控制面板 -->
            <section class="control-panel glass-card" id="controlPanel">
                <div class="panel-header">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <h2>数据筛选</h2>
                </div>

                <div class="control-grid">
                    <!-- 数据源选择 -->
                    <div class="form-group form-group-full">
                        <label class="form-label">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path
                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            数据源
                        </label>
                        <div class="chip-group" id="sourceChips">
                            <div class="loading-text">加载数据源...</div>
                        </div>
                    </div>
                    <!-- 频道选择 -->
                    <div class="form-group">
                        <label class="form-label">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" />
                            </svg>
                            频道
                        </label>
                        <div class="chip-group" id="genderChips">
                            <button class="chip active" data-value="" onclick="selectChip(this, 'gender')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                                    <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" />
                                </svg>
                                全部
                            </button>
                            <button class="chip" id="chipCategoryRank" onclick="switchDataView('category')">
                                📊 分类排行
                            </button>
                            <button class="chip" data-value="male" onclick="selectChip(this, 'gender')">男频</button>
                            <button class="chip" data-value="female" onclick="selectChip(this, 'gender')">女频</button>
                        </div>
                    </div>

                    <!-- 排序 -->
                    <div class="form-group">
                        <label class="form-label">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M11 5h10M11 9h7M11 13h4" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" />
                                <path d="M3 4l3 3 3-3M6 7v10" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            排序
                        </label>
                        <select class="form-select glass-input" id="sortSelect">
                            <option value="rank">按排名</option>
                            <option value="heat">🔥 按热度/在读</option>
                            <option value="category">按分类</option>
                            <option value="gender">按频道</option>
                            <option value="period">按榜单</option>
                        </select>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="action-bar">
                    <button class="btn btn-primary" id="btnScrape" onclick="doScrape()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M21 12a9 9 0 1 1-6.22-8.56" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                            <path d="M21 3v6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        查看数据
                    </button>
                    <button class="btn btn-secondary" id="btnFeishu" onclick="pushFeishu()" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        推送飞书
                    </button>
                </div>
            </section>

            <!-- 统计信息 -->
            <section class="stats-bar" id="statsBar" style="display:none">
                <div class="stat-card glass-card">
                    <div class="stat-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-value" id="statTotal">0</span><span
                            class="stat-label">总书籍</span></div>
                </div>
                <div class="stat-card glass-card" style="cursor:pointer"
                    onclick="document.getElementById('categoryRankInline').scrollIntoView({behavior:'smooth'})"
                    title="跳转到分类热度排行">
                    <div class="stat-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                            <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                            <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                            <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-value" id="statCategories">0</span><span
                            class="stat-label">分类数 ↓</span></div>
                </div>
                <div class="stat-card glass-card">
                    <div class="stat-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                            <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-value" id="statTime">-</span><span
                            class="stat-label">数据日期</span></div>
                </div>
            </section>

            <!-- 加载动画 -->
            <section class="loading-section glass-card" id="loadingSection" style="display:none">
                <div class="loading-spinner">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" class="spin">
                        <path d="M21 12a9 9 0 1 1-6.22-8.56" stroke="currentColor" stroke-width="2.5"
                            stroke-linecap="round" />
                    </svg>
                </div>
                <p class="loading-message" id="loadingMsg">正在加载数据...</p>
            </section>

            <!-- 数据展示区（分类/热度共用） -->
            <section id="dataDisplaySection" style="display:none">

                <!-- 分类排行视图 -->
                <div class="glass-card category-rank-inline" id="categoryRankInline">
                    <p class="cat-rank-desc">按各分类在读 Top10 热度累加排序，点击展开查看具体书籍</p>
                    <div id="categoryRankContent"></div>
                </div>

                <!-- 热度排序视图 -->
                <div id="resultsSection" style="display:none">
                    <div id="resultsContainer"></div>
                </div>
            </section>

            <!-- 空状态 -->
            <section class="empty-state glass-card" id="emptyState">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" class="empty-icon">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M9 9l6 6M15 9l-6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                </svg>
                <h3>选择数据源，查看排行榜</h3>
                <p>先在「市场看板」全量获取数据，然后在此按条件筛选查看</p>
            </section>
        </div>

        <!-- ==================== 下载管理页面（全屏覆盖） ==================== -->
        <div class="dl-page-overlay" id="dlPageOverlay" style="display:none">
            <div class="dl-page-container">
                <!-- 返回导航 -->
                <header class="dl-page-header glass-surface">
                    <button class="icon-btn" onclick="toggleDownloadPage()" title="返回">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <h2 class="dl-page-title">下载管理</h2>
                    <div class="dl-page-header-right">
                        <div class="dl-status-info">
                            <div class="dl-status-dot" id="dlStatusDot"></div>
                            <span id="dlStatusText">检查服务中...</span>
                        </div>
                        <span class="dl-status-version" id="dlStatusVersion"></span>
                    </div>
                </header>

                <!-- 搜索栏 -->
                <section class="glass-card dl-search-section">
                    <div class="dl-search-bar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" />
                            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <input type="text" class="glass-input dl-search-input" id="dlSearchInput"
                            placeholder="输入书名或 book_id 搜索..." onkeydown="if(event.key==='Enter')dlSearch()">
                        <button class="btn btn-primary btn-sm" onclick="dlSearch()">搜索</button>
                    </div>
                </section>

                <!-- 搜索结果 -->
                <section class="glass-card" id="dlSearchResults" style="display:none">
                    <div class="dl-section-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" />
                            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        <h3>搜索结果</h3>
                        <span class="badge" id="dlSearchCount">0</span>
                    </div>
                    <div id="dlSearchList"></div>
                </section>

                <!-- 下载任务 -->
                <section class="glass-card">
                    <div class="dl-section-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <polyline points="7 10 12 15 17 10" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                        <h3>下载任务</h3>
                        <button class="btn btn-outline btn-sm" onclick="dlRefreshJobs()">↻ 刷新</button>
                    </div>
                    <div id="dlJobsList">
                        <div class="dl-empty">暂无下载任务</div>
                    </div>
                </section>

                <!-- 书库 -->
                <section class="glass-card">
                    <div class="dl-section-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <h3>已下载书库</h3>
                        <button class="btn btn-outline btn-sm" onclick="dlRefreshLibrary()">↻ 刷新</button>
                    </div>
                    <div id="dlLibraryList">
                        <div class="dl-empty">书库为空</div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- 分类详情弹窗 -->
    <div class="modal-overlay" id="categoryModal" style="display:none"
        onclick="if(event.target===this)closeCategoryModal()">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <div class="modal-header-left">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                        <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                        <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                        <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2" />
                    </svg>
                    <h2 id="modalCategoryTitle">分类</h2>
                </div>
                <button class="icon-btn" onclick="closeCategoryModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modalCategoryBody"></div>
        </div>
    </div>

    <!-- 设置弹窗 -->
    <div class="modal-overlay" id="settingsModal" style="display:none"
        onclick="if(event.target===this)closeSettingsModal()">
        <div class="modal-content glass-card" style="max-width:480px">
            <div class="modal-header">
                <div class="modal-header-left">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <h2>设置</h2>
                </div>
                <button class="icon-btn" onclick="closeSettingsModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3 class="settings-title">⏰ 每日定时同步</h3>
                    <p class="settings-desc">设置每天自动拉取所有平台排行榜数据的时间</p>
                    <div class="settings-row">
                        <label class="settings-label">启用定时同步</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="settingsEnabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-row">
                        <label class="settings-label">同步时间</label>
                        <input type="time" id="settingsSyncTime" class="glass-input settings-time-input" value="08:00">
                    </div>
                    <div class="settings-row" id="settingsLastSync" style="display:none">
                        <label class="settings-label">上次同步</label>
                        <span class="settings-value" id="settingsLastSyncText">-</span>
                    </div>
                </div>
                <div class="settings-actions">
                    <button class="btn btn-primary" onclick="saveSettings()">💾 保存设置</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 热度趋势弹窗 -->
    <div class="modal-overlay" id="trendModal" style="display:none" onclick="if(event.target===this)closeTrendModal()">
        <div class="modal-content glass-card" style="max-width:720px">
            <div class="modal-header">
                <div class="modal-header-left">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <path d="M23 6l-9.5 9.5-5-5L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M17 6h6v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <h2 id="trendModalTitle">热度趋势</h2>
                </div>
                <button class="icon-btn" onclick="closeTrendModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="trendModalBody">
                <div class="trend-chart-wrap">
                    <canvas id="trendCanvas" width="660" height="280"></canvas>
                </div>
                <div id="trendDataTable"></div>
            </div>
        </div>
    </div>

    <!-- Toast 提示 -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="app.js"></script>
</body>

</html>